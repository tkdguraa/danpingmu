extends layout.jade
block contents
        #M1.content
          .container-fluid
            .row
              .col-md-12
                .card.card-plain
                  .header
                    h4.title 活动列表
                  .content.table-responsive.table-full-width
                    table.table.table-hover
                      thead
                        tr  
                          th 
                            input#all.check(type='checkbox') 
                            | NO
                          th 昵称
                          th 内容
                          th 状态
                          th 审核
                      tbody
block script
  script(src='/assets/js/jquery.3.2.1.min.js', type='text/javascript')
  script(src='/assets/js/bootstrap.min.js', type='text/javascript')
    // Charts Plugin
    // Notifications Plugin
  script(src='/assets/js/bootstrap-notify.js')
    // Light Bootstrap Table Core javascript and methods for Demo purpose
  script(src='/assets/js/light-bootstrap-dashboard.js?v=1.4.0')
    // Light Bootstrap Table DEMO methods, don't include it in your project!

  //socket.io
  script(src='/socket.io/socket.io.js')
  script.
    var activity_id = !{activity_id != null? JSON.stringify(activity_id): 'null'};
    var msg_list = !{msg_list != null? JSON.stringify(msg_list): 'null'};
    $(document).ready(function(){
      $('#M' + $('.content').attr('id')).attr('class','active');
    })  
    $(function() {
      var socket = io();
      var data = {'activity_id': activity_id};
      socket.emit('joinActivity', data);
      console.log('activity_id: ', activity_id);
      console.log('msg_list: ', msg_list);
  
      msg_list.forEach((msg) => {
         if(msg == null)
           return;
         $('tbody').append("<tr id=list" + msg.id + "></tr>");
         $('#list' + msg.id).append("<td><input type='checkbox' class = check id =" + msg.id + '>' + msg.id);
         $('#list' + msg.id).append($("<td>").text(msg.nickname));
         $('#list' + msg.id).append($("<td>").text(msg.content));

         //$('#list' + msg.id).append($("<td>").text(msg.review_flag));
         if(msg.review_flag == false)       
            $('#list' + msg.id).append("<td><a href='javascript:;' class=admit id=permit" + msg.id + " style='color:orange;'>WAITING</a></td>");
         else
            $('#list' + msg.id).append("<td><a href='javascript:;' class=admit id=permit" + msg.id + " style='color:GREEN;'>PERMITTED</a></td>"); 
         $('#list' + msg.id).append("<td><button class='join btn btn-warning btn-fill'>通过</button></td>"); 
     });
      for (let msg of msg_list) {
        socket.emit('passReview', msg);
      }
  
      socket.on('review', function(data) {
        console.log('on review: ', data);
        msg_obj = JSON.parse(data.msg);
        $("#messages").append($('<li>').text(msg_obj.content));
        socket.emit('passReview', data);
      });
    });
    $(document).on('click','input.check',function(){
      if(this.id == 'all'){
        if(this.checked == 1){
           $("input[type='checkbox']").each(function(){
             this.checked = 1;
           });
        }
        else{
          $("input[type='checkbox']").each(function(){
            this.checked = 0;
          })
        } 
      }
      else{
        if(this.checked == 0)
          this.checked = 0;
        else
          this.checked = 1;
      }
    });
    $(document).on('click','a.admit',function(){
      if(this.text == 'WAITING'){
       $(this).text('PERMITTED');
       $(this).css('color','green');
      }
    })
    
