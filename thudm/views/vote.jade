doctype html
html(lang="zh-CN")
    head
      meta(charset="utf-8")
      title 投票
      script(src="/js/ajax.js")
      script.
          var options = !{options != null? JSON.stringify(options): 'null'};
          var pic_urls = !{pic_urls != null? JSON.stringify(pic_urls): 'null'};
          console.log("options = ",options);
          console.log("pic_urls = ",pic_urls);
          $(document).ready(function(){
              var op_num = options.length;
              var candy_num = 0;
              var line_num;
              if (op_num % 2 == 0){
                  line_num = op_num / 2;
                  for(var i = 0; i < line_num; i++){
                    $('div.total').append("<div class = 'line' id = line" + i + '>'+ '</div>');
                    $('#line' + i).append("<div class = 'candidate' id = candy" + candy_num + '>' + '</div>');
                    candy_num++;
                    $('#line' + i).append("<div class = 'candidate' id = candy" + candy_num + '>' + '</div>');
                    candy_num++;
                  }
              }
              else {
                  line_num = op_num / 2 + 1;
                  for(var i = 0; i < line_num; i++){
                    $('div.total').append("<div class = 'line' id = line" + i + '>'+ '</div>');
                    $('#line' + id).append("<div class = 'candidate' id = candy" + candy_num + '>' + '</div>');
                    candy_num++;
                    $('#line' + id).append("<div class = 'candidate' id = candy" + candy_num + '>' + '</div>');
                    candy_num++;
                  }
              }
             console.log(line_num - 1);
             $('#line' + (line_num - 1)).append('<input type = button action = vote class = voteit value = Vote>');
             for(var id = 0; id < op_num; id++){
                 $('#candy' + id).append("<div class = form  id = form" + id + '></div>');
                 $('#form' + id).append("<img src = " + pic_urls[id] + '>');
                 $('#form' + id).append("<div class = title id = title" + id +'>' + '</div>');
                 $('#title' + id).append("<input type = 'radio' class = check  id = radio" + id + ">" + options[id]);
             }
              
             $("input.check").click(function(){
               for(var i = 0; i < $("input.check").length; i++){
                 if($(this).attr('id') != ('radio' + i)){
                   $("#radio" + i).attr("checked",false);
                 }
               }
             });
             $("input.voteit").click(function(){
               var flag = 0;
               for(var i = 0; i < $("input.check").length; i++){
                 if($("#radio" + i).attr('checked') == true){
                    flag = 1;
                    console.log("vote id = ",i);
                    $.ajax({
                      type:"GET",
                      data:{"vote": i},
                      dataType:"text",
                      url:"/vote/5bf01187dadb0b7d97d0ef36/votefor/" + i,
                      success: function(data){
                        alert("OK");
                        console.log(data);
                      },
                      error: function(XMLHttpRequest,textStatus,errorThrown){
                       alert(XMLHttpRequest.status);
                       alert(XMLHttpRequest.readyState);
                       alert(textStatus);
                      }
                    })
                 }
                 window.location = "../../vote_warning.html";
               }
               if(flag == 0)
                alert("请选择一个对象");
             })
 
          });
   body
      .total

style(type="text/css").
  div.total{
      position:relative;
      width:100vw;
      height:100vh;
  }
  div.line{
      position:relative;
      width:100%;
      height:30%;
  }
  div.candidate{
      position:relative;
      width:50%;
      height:100%;
      float:left;
      border-radius:20px;
  }
  div.form{
      position:relative;
      background:rgba(0,0,0,0.3);
      border-radius: 20px;
      left:10%;
      width:80%;
      height:80%;
  }
  div.title{
      position:relative;
      text-align:center;
      width:auto;
  }
  input.voteit{
      position:relative;
      left:45%;
      width:10%;

  }
  div.content{
      position:relative;
      width:100%;
      text-align:center;
      height:auto;
      float:left;
  }
  input.check{
      position:relative;
  }
  img{
      position:relative;
      width:60%;
      height:70%;
      left:20%;
      border-radius:20px;
  }
  body, html{
  background: url(/images/bg.jpg);
  }
